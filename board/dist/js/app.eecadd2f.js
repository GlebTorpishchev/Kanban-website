(function(){"use strict";var o={9551:function(o,e,t){var r=t(5130),s=t(6768);const a={class:"container"},l={key:0,class:"title"},n={key:1,class:"description"};function c(o,e,t,r,c,i){const d=(0,s.g2)("router-link"),u=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",a,[i.showHeader?((0,s.uX)(),(0,s.CE)("h1",l,"Доски")):(0,s.Q3)("",!0),i.showHeader?((0,s.uX)(),(0,s.CE)("p",n,"Войдите, чтобы воспользоваться сервисом")):(0,s.Q3)("",!0),i.showHeader?((0,s.uX)(),(0,s.Wv)(d,{key:2,to:"/login",class:"button login-button"},{default:(0,s.k6)((()=>[(0,s.eW)("Вход")])),_:1})):(0,s.Q3)("",!0),i.showHeader?((0,s.uX)(),(0,s.Wv)(d,{key:3,to:"/register",class:"button register-button"},{default:(0,s.k6)((()=>[(0,s.eW)("Регистрация")])),_:1})):(0,s.Q3)("",!0),(0,s.bF)(u)])}var i={name:"App",computed:{showHeader(){return console.log("Current route:",this.$route.path),"/board"!==this.$route.path}}},d=t(1241);const u=(0,d.A)(i,[["render",c],["__scopeId","data-v-1f4d6e29"]]);var h=u,p=t(1387),m=t(4232),C=t.p+"img/visibility.623bd04f.svg",g=t.p+"img/visibility_off.a5b564e0.svg";const k={class:"form-container"},b=(0,s.Lk)("div",{class:"form-header"},"Вход",-1),f={class:"form-group"},y=(0,s.Lk)("label",{for:"login"},"Логин или E-mail",-1),w={class:"form-group"},v=(0,s.Lk)("label",{for:"password"},"Пароль",-1),E={class:"password-input"},F=["type"],_={key:0,src:C,alt:"Показать пароль",class:"icon"},L={key:1,src:g,alt:"Скрыть пароль",class:"icon"},T={class:"form-group"},D={for:"rememberMe",class:"checkbox-label"},S={key:0,class:"error-message"},P=(0,s.Lk)("button",{type:"submit"},"Войти",-1);function O(o,e,t,a,l,n){return(0,s.uX)(),(0,s.CE)("div",k,[b,(0,s.Lk)("form",{onSubmit:e[4]||(e[4]=(0,r.D$)(((...o)=>n.handleLogin&&n.handleLogin(...o)),["prevent"])),class:"form"},[(0,s.Lk)("div",f,[y,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"login","onUpdate:modelValue":e[0]||(e[0]=o=>l.login=o),required:""},null,512),[[r.Jo,l.login]])]),(0,s.Lk)("div",w,[v,(0,s.Lk)("div",E,[(0,s.bo)((0,s.Lk)("input",{type:l.showPassword?"text":"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=o=>l.password=o),required:""},null,8,F),[[r.hp,l.password]]),(0,s.Lk)("div",{class:"password-icon",onClick:e[2]||(e[2]=(...o)=>n.toggleShowPassword&&n.toggleShowPassword(...o))},[l.showPassword?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("img",_)),l.showPassword?((0,s.uX)(),(0,s.CE)("img",L)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",T,[(0,s.Lk)("label",D,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",id:"rememberMe","onUpdate:modelValue":e[3]||(e[3]=o=>l.rememberMe=o)},null,512),[[r.lH,l.rememberMe]]),(0,s.eW)(" Запомнить меня ")])]),l.errorMessage?((0,s.uX)(),(0,s.CE)("div",S,(0,m.v_)(l.errorMessage),1)):(0,s.Q3)("",!0),P],32)])}t(4114);var M={data(){return{login:"",password:"",rememberMe:!1,errorMessage:null,showPassword:!1}},mounted(){const o=localStorage.getItem("login");o&&(this.login=o)},methods:{async handleLogin(){this.errorMessage=null;try{const o=await fetch("http://localhost/X-men/back/login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:this.login,password:this.password}),credentials:"include"}),e=await o.json();e.success?(this.rememberMe?localStorage.setItem("login",this.login):localStorage.removeItem("login"),localStorage.setItem("userid",e.user_id),localStorage.setItem("username",e.login),this.$router.push("/board")):this.errorMessage=e.error||"Неверный логин или пароль"}catch(o){this.errorMessage="Ошибка при входе: "+o.message}},toggleShowPassword(){this.showPassword=!this.showPassword}}};const X=(0,d.A)(M,[["render",O]]);var I=X;const j={class:"form-container"},x=(0,s.Lk)("div",{class:"form-header"},"Регистрация",-1),U={class:"form-group"},B=(0,s.Lk)("label",{for:"email"},"E-mail",-1),$={class:"form-group"},A=(0,s.Lk)("label",{for:"login"},"Логин",-1),N={class:"form-group"},J=(0,s.Lk)("label",{for:"password"},"Пароль",-1),Q={class:"password-input"},V=["type"],H={key:0,src:C,alt:"Показать пароль",class:"icon"},q={key:1,src:g,alt:"Скрыть пароль",class:"icon"},K=(0,s.Lk)("button",{type:"submit"},"Отправить",-1);function W(o,e,t,a,l,n){return(0,s.uX)(),(0,s.CE)("div",j,[x,(0,s.Lk)("form",{onSubmit:e[4]||(e[4]=(0,r.D$)(((...o)=>n.registerUser&&n.registerUser(...o)),["prevent"])),class:"form"},[(0,s.Lk)("div",U,[B,(0,s.bo)((0,s.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=o=>l.email=o),required:""},null,512),[[r.Jo,l.email]])]),(0,s.Lk)("div",$,[A,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"login","onUpdate:modelValue":e[1]||(e[1]=o=>l.login=o),required:""},null,512),[[r.Jo,l.login]])]),(0,s.Lk)("div",N,[J,(0,s.Lk)("div",Q,[(0,s.bo)((0,s.Lk)("input",{type:l.showPassword?"text":"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=o=>l.password=o),required:""},null,8,V),[[r.hp,l.password]]),(0,s.Lk)("div",{class:"password-icon",onClick:e[3]||(e[3]=(...o)=>n.toggleShowPassword&&n.toggleShowPassword(...o))},[l.showPassword?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("img",H)),l.showPassword?((0,s.uX)(),(0,s.CE)("img",q)):(0,s.Q3)("",!0)])])]),K],32)])}var R={data(){return{login:"",password:"",email:"",showPassword:!1}},methods:{async registerUser(){try{const o=JSON.stringify({login:this.login,password:this.password,email:this.email}),e=await fetch("http://localhost/X-men/back/register.php",{method:"POST",headers:{"Content-Type":"application/json"},body:o}),t=await e.json();console.log(t),t.success?(this.$router.push("/login"),alert("Вы успешно зарегистрированы!")):console.error("Ошибка регистрации:",t.error)}catch(o){console.error("Ошибка:",o)}},toggleShowPassword(){this.showPassword=!this.showPassword}}};const G=(0,d.A)(R,[["render",W]]);var z=G,Y=t.p+"img/logout.74921cd8.svg";const Z={class:"board-page"},oo={class:"board-header"},eo={class:"fixed-bar"},to={class:"board-controls"},ro={class:"user-info"},so={class:"user-details"},ao={class:"user-name"};function lo(o,e,t,r,a,l){const n=(0,s.g2)("TaskColumn"),c=(0,s.g2)("draggable");return(0,s.uX)(),(0,s.CE)("div",Z,[(0,s.Lk)("div",oo,[(0,s.Lk)("div",eo,[(0,s.Lk)("div",to,[(0,s.Lk)("button",{onClick:e[0]||(e[0]=(...o)=>l.createColumn&&l.createColumn(...o)),class:"create-column-btn"},"Создать колонку"),(0,s.Lk)("button",{onClick:e[1]||(e[1]=(...o)=>l.toggleEditMode&&l.toggleEditMode(...o)),class:"edit-columns-btn"},(0,m.v_)(a.isEditMode?"Сохранить порядок":"Изменить порядок"),1)]),(0,s.Lk)("div",ro,[(0,s.Lk)("div",so,[(0,s.Lk)("div",ao,(0,m.v_)(a.loggedInUser),1),(0,s.Lk)("img",{src:Y,alt:"Logout",class:"logout-icon",onClick:e[2]||(e[2]=(...o)=>l.logout&&l.logout(...o))})])])])]),(0,s.bF)(c,{modelValue:a.columns,"onUpdate:modelValue":e[4]||(e[4]=o=>a.columns=o),disabled:!a.isEditMode,onEnd:l.updateOrder,group:"columns",class:"board-columns",itemKey:"column_id"},{item:(0,s.k6)((({element:t,index:r})=>[((0,s.uX)(),(0,s.Wv)(n,{key:t.column_id,column:t,index:r,onUpdateColumn:o=>l.updateColumn(r,o),onDeleteColumn:o=>l.deleteColumn(r),onUpdateCards:e=>o.updateCards(r,e),onMoveCard:e[3]||(e[3]=o=>l.moveCard(o))},null,8,["column","index","onUpdateColumn","onDeleteColumn","onUpdateCards"]))])),_:1},8,["modelValue","disabled","onEnd"])])}const no=o=>((0,s.Qi)("data-v-1b079e11"),o=o(),(0,s.jt)(),o),co={class:"column"},io={class:"column-header"},uo={class:"color-circles"},ho=no((()=>(0,s.Lk)("i",{class:"fas fa-trash"},null,-1))),po=[ho],mo={key:0},Co={key:1},go=no((()=>(0,s.Lk)("span",{class:"btn-text"},"Создать карточку",-1))),ko=[go],bo=no((()=>(0,s.Lk)("h3",null,"Выберите цвет",-1))),fo={class:"color-options"},yo=["onClick"],wo={key:1,class:"delete-confirmation"},vo=no((()=>(0,s.Lk)("p",null,"Вы точно хотите удалить колонку и ее содержимое?",-1))),Eo={class:"confirmation-buttons"};function Fo(o,e,t,a,l,n){const c=(0,s.g2)("TaskCard"),i=(0,s.g2)("draggable");return(0,s.uX)(),(0,s.CE)("div",co,[(0,s.Lk)("div",io,[(0,s.Lk)("div",uo,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.lastSelectedColors,((o,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,style:(0,m.Tr)({backgroundColor:o}),class:"color-circle",onClick:e[0]||(e[0]=(...o)=>n.openColorPicker&&n.openColorPicker(...o))},null,4)))),128))]),(0,s.Lk)("button",{class:"delete-column-btn",onClick:e[1]||(e[1]=(...o)=>n.confirmDeleteColumn&&n.confirmDeleteColumn(...o))},po)]),(0,s.Lk)("div",{style:(0,m.Tr)({backgroundColor:n.backgroundColor}),class:"column-body"},[(0,s.Lk)("div",{class:"column-title",style:(0,m.Tr)({color:n.textColor})},[(0,s.Lk)("div",{onDblclick:e[5]||(e[5]=(...o)=>n.toggleEditMode&&n.toggleEditMode(...o))},[l.isEditMode||l.localTitle?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",mo,(0,m.v_)("New Column"))),!l.isEditMode&&l.localTitle?((0,s.uX)(),(0,s.CE)("span",Co,(0,m.v_)(l.localTitle),1)):(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=o=>l.localTitle=o),onBlur:e[3]||(e[3]=(...o)=>n.saveColumn&&n.saveColumn(...o)),onKeydown:e[4]||(e[4]=(0,r.jR)(((...o)=>n.saveColumn&&n.saveColumn(...o)),["enter"])),class:"column-input"},null,544)),[[r.Jo,l.localTitle]])],32)],4),(0,s.Lk)("button",{class:"create-card-btn",onClick:e[6]||(e[6]=(...o)=>n.createCard&&n.createCard(...o))},ko),(0,s.bF)(i,{modelValue:l.localCards,"onUpdate:modelValue":e[7]||(e[7]=o=>l.localCards=o),group:"cards",itemKey:"id",class:"cards",onEnd:n.updateCardOrder},{item:(0,s.k6)((({element:o,index:e})=>[(0,s.bF)(c,{card:o,onUpdateCard:o=>n.updateCard(e,o),onDeleteCard:o=>n.deleteCard(e),onChangeColor:o=>n.changeCardColor(e,o)},null,8,["card","onUpdateCard","onDeleteCard","onChangeColor"])])),_:1},8,["modelValue","onEnd"]),l.showColorPicker?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"color-picker-overlay",onClick:e[9]||(e[9]=(...o)=>n.closeColorPicker&&n.closeColorPicker(...o))},[(0,s.Lk)("div",{class:"color-picker",onClick:e[8]||(e[8]=(0,r.D$)((()=>{}),["stop"]))},[bo,(0,s.Lk)("div",fo,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableColors,(o=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"color-option",style:(0,m.Tr)({backgroundColor:o}),onClick:e=>n.selectColor(o)},null,12,yo)))),128))])])])):(0,s.Q3)("",!0),l.showDeleteConfirmation?((0,s.uX)(),(0,s.CE)("div",wo,[vo,(0,s.Lk)("div",Eo,[(0,s.Lk)("button",{class:"confirm-btn",onClick:e[10]||(e[10]=(...o)=>n.deleteColumn&&n.deleteColumn(...o))},"Да"),(0,s.Lk)("button",{class:"cancel-btn",onClick:e[11]||(e[11]=(...o)=>n.hideDeleteConfirmation&&n.hideDeleteConfirmation(...o))},"Нет")])])):(0,s.Q3)("",!0)],4)])}const _o=o=>((0,s.Qi)("data-v-3f05308c"),o=o(),(0,s.jt)(),o),Lo={key:0,class:"card-header"},To={key:1,class:"card-header"},Do=["innerHTML"],So={key:3,class:"card-description"},Po=_o((()=>(0,s.Lk)("i",{class:"fas fa-trash"},null,-1))),Oo=_o((()=>(0,s.Lk)("span",null,"удалить",-1))),Mo=[Po,Oo],Xo=_o((()=>(0,s.Lk)("h3",{class:"color-picker-label"},"Выберите цвет",-1))),Io={class:"color-options"},jo=["onClick"];function xo(o,e,t,a,l,n){return(0,s.uX)(),(0,s.CE)("div",{class:"card",style:(0,m.Tr)({backgroundColor:t.card.color,color:n.textColor})},[l.isEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Lo,[(0,s.Lk)("span",{onDblclick:e[0]||(e[0]=(...o)=>n.toggleEditMode&&n.toggleEditMode(...o)),class:"card-title"},(0,m.v_)(n.displayTitle),33),(0,s.Lk)("div",{onClick:e[1]||(e[1]=(...o)=>n.openColorPicker&&n.openColorPicker(...o)),class:"color-box",style:(0,m.Tr)({borderColor:n.borderColor})},null,4)])),l.isEditMode?((0,s.uX)(),(0,s.CE)("div",To,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.localTitle=o),onBlur:e[3]||(e[3]=(...o)=>n.saveCard&&n.saveCard(...o)),onKeydown:e[4]||(e[4]=(0,r.jR)(((...o)=>n.saveCard&&n.saveCard(...o)),["enter"])),placeholder:"New card",class:"card-input"},null,544),[[r.Jo,l.localTitle]])])):(0,s.Q3)("",!0),l.isEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",{key:2,class:"card-description",onDblclick:e[5]||(e[5]=(...o)=>n.toggleEditMode&&n.toggleEditMode(...o))},[(0,s.Lk)("span",{innerHTML:n.formattedDescription},null,8,Do)],32)),l.isEditMode?((0,s.uX)(),(0,s.CE)("div",So,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.localDescription=o),onBlur:e[7]||(e[7]=(...o)=>n.saveCard&&n.saveCard(...o)),onKeydown:e[8]||(e[8]=(0,r.jR)((0,r.D$)(((...o)=>n.newLine&&n.newLine(...o)),["ctrl"]),["enter"])),rows:"3",placeholder:"Введите описание"},null,544),[[r.Jo,l.localDescription]]),(0,s.Lk)("button",{class:"save-card-btn",onClick:e[9]||(e[9]=(...o)=>n.saveCard&&n.saveCard(...o))},"Сохранить")])):(0,s.Q3)("",!0),l.isEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:4,class:"delete-card-btn",onClick:e[10]||(e[10]=(...o)=>n.deleteCard&&n.deleteCard(...o))},Mo)),l.showColorPicker?((0,s.uX)(),(0,s.CE)("div",{key:5,class:"color-picker-overlay",onClick:e[12]||(e[12]=(...o)=>n.closeColorPicker&&n.closeColorPicker(...o))},[(0,s.Lk)("div",{class:"color-picker",onClick:e[11]||(e[11]=(0,r.D$)((()=>{}),["stop"]))},[Xo,(0,s.Lk)("div",Io,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableColors,(o=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"color-option",style:(0,m.Tr)({backgroundColor:o}),onClick:e=>n.selectColor(o)},null,12,jo)))),128))])])])):(0,s.Q3)("",!0)],4)}var Uo={name:"TaskCard",props:{card:Object},data(){return{isEditMode:!1,localTitle:this.card.name,localDescription:this.card.text,showColorPicker:!1,availableColors:["#666666","#66664D","#9900B3","#991AFF","#FF4D4D","#B33300","#999966","#CC9999","#CCCC00","#999933","#809980","#4D8066","#4DB380","#B33300","#E64D66","#E6331A","#FF5733","#B34D4D","#E6B3B3","#FF1A66","#E666FF","#FF3380","#FF33FF","#1AB399","#4DB3FF","#66991A","#99E6E6","#80B300","#33FFFF","#00E680","#33FFCC","#66E64D","#FFFF33","#99FF99","#E6FF80","#FFB399","#FFB3E6","#FFD1DC","#FFE6CC","#FFFFCC"]}},methods:{toggleEditMode(){this.isEditMode=!this.isEditMode,this.isEditMode&&"Новая карточка"===this.localTitle&&(this.localTitle="")},async saveCard(){const o={...this.card,name:this.localTitle,text:this.localDescription};try{const e=await fetch("http://localhost/X-men/back/update_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();t.success&&this.$emit("updateCard",o),this.isEditMode=!1}catch(e){console.error("Ошибка:",e)}},deleteCard(){this.$emit("deleteCard")},openColorPicker(){this.showColorPicker=!0},closeColorPicker(){this.showColorPicker=!1},async selectColor(o){const e={...this.card,color:o};try{const o=await fetch("http://localhost/X-men/back/update_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await o.json();t.success?this.$emit("updateCard",e):console.error("Ошибка при изменении цвета карточки:",t.error||"Неизвестная ошибка")}catch(t){console.error("Ошибка при изменении цвета карточки:",t)}this.closeColorPicker()},newLine(){this.localDescription+="\n"}},computed:{textColor(){const o=this.card.color.replace("#",""),e=parseInt(o.substring(0,2),16),t=parseInt(o.substring(2,4),16),r=parseInt(o.substring(4,6),16),s=(299*e+587*t+114*r)/1e3;return s>125?"black":"white"},borderColor(){const o=this.card.color.replace("#",""),e=parseInt(o.substring(0,2),16),t=parseInt(o.substring(2,4),16),r=parseInt(o.substring(4,6),16),s=(299*e+587*t+114*r)/1e3;return s>125?"black":"white"},formattedDescription(){return this.localDescription?this.localDescription.replace(/\n/g,"<br/>"):"Описание<br/><i>Введите двойным кликом</i>"},displayTitle(){return this.localTitle||"New card"}},watch:{card:{handler(o){this.localTitle=o.name,this.localDescription=o.text},deep:!0}}};const Bo=(0,d.A)(Uo,[["render",xo],["__scopeId","data-v-3f05308c"]]);var $o=Bo,Ao=t(1527),No=t.n(Ao),Jo={name:"TaskColumn",components:{TaskCard:$o,draggable:No()},props:{column:{type:Object,required:!0,default:()=>({column_id:null,column_name:"Новая колонка",cards:[],color:["#d9d9d9","#d9d9d9","#d9d9d9"]})},index:Number},data(){return{isEditMode:!1,localTitle:this.column.column_name||"Новая колонка",localCards:this.column.cards||[],lastSelectedColors:this.column.color&&this.column.color.slice(-3)||["#d9d9d9","#d9d9d9","#d9d9d9"],showColorPicker:!1,showDeleteConfirmation:!1,availableColors:["#666666","#66664D","#9900B3","#991AFF","#FF4D4D","#B33300","#999966","#CC9999","#CCCC00","#999933","#809980","#4D8066","#4DB380","#B33300","#E64D66","#E6331A","#FF5733","#B34D4D","#E6B3B3","#FF1A66","#E666FF","#FF3380","#FF33FF","#1AB399","#4DB3FF","#66991A","#99E6E6","#80B300","#33FFFF","#00E680","#33FFCC","#66E64D","#FFFF33","#99FF99","#E6FF80","#FFB399","#FFB3E6","#FFD1DC","#FFE6CC","#FFFFCC"]}},computed:{backgroundColor(){return this.lastSelectedColors[0]},textColor(){return this.getContrastingTextColor(this.lastSelectedColors[0])}},methods:{toggleEditMode(){this.isEditMode=!this.isEditMode},checkMove(o){return o.from!==o.to},onCardDrop(o){o.from!==o.to&&this.$emit("moveCard",{card:o.item,fromColumn:o.from.dataset.columnId,toColumn:o.to.dataset.columnId})},async onDragEnd(){const o=this.localCards.map(((o,e)=>({...o,order:e,column_id:this.column.column_id})));try{await this.$parent.updateCardsOrder(this.column.column_id,o)}catch(e){console.error("Ошибка при обновлении порядка карточек:",e)}},async saveColumn(){try{this.isEditMode=!1;const o={column_id:this.column.column_id,column_name:this.localTitle,color:this.lastSelectedColors};this.$emit("updateColumn",o);const e=await fetch("http://localhost/X-men/back/update_column.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();t.success?console.log("Название колонки успешно обновлено"):console.error("Ошибка при обновлении названия колонки:",t.error)}catch(o){console.error("Ошибка при сохранении колонки:",o)}},async createCard(){const o={card_id:Date.now(),name:"",text:"",color:"#666666",column_id:this.column.column_id,order:this.localCards.length};try{const e=await fetch("http://localhost/X-men/back/create_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();t.id?(o.card_id=t.id,this.localCards.push(o),this.$emit("updateCards",this.localCards)):console.error("Ошибка при создании карточки:",t.error||"Неизвестная ошибка")}catch(e){console.error("Error creating card:",e)}},async updateCard(o,e){try{const t=await fetch("http://localhost/X-men/back/update_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();r.success?(this.localCards.splice(o,1,e),this.$emit("updateCards",this.localCards)):console.error("Failed to update card:",r.error||"Unknown error")}catch(t){console.error("Error updating card:",t)}},async deleteCard(o){const e=this.localCards[o].card_id;try{const t=await fetch("http://localhost/X-men/back/delete_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),r=await t.json();r.success&&(this.localCards.splice(o,1),this.$emit("updateCards",this.localCards))}catch(t){console.error("Ошибка:",t)}},async updateCardOrder(){const o=this.localCards.map(((o,e)=>({card_id:o.card_id,column_id:this.column.column_id,order:e})));try{const e=await fetch("http://localhost/X-men/back/update_card_order.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();t.success?(console.log("Card order successfully updated"),this.$emit("updateCards",this.localCards)):console.error("Error updating card order:",t.error)}catch(e){console.error("Network Error:",e)}},async changeCardColor(o,e){const t=this.localCards[o];t.color=e;try{const o=await fetch("http://localhost/X-men/back/update_card.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),e=await o.json();e.success?this.$emit("updateCards",this.localCards):console.error("Ошибка при изменении цвета карточки:",e.error||"Неизвестная ошибка")}catch(r){console.error("Ошибка при изменении цвета карточки:",r)}},openColorPicker(){this.showColorPicker=!0},closeColorPicker(){this.showColorPicker=!1},selectColor(o){this.lastSelectedColors=[o,...this.lastSelectedColors.slice(0,2)],this.showColorPicker=!1,this.$emit("changeColumnColor",this.index,o),this.saveColumn()},confirmDeleteColumn(){this.showDeleteConfirmation=!0},hideDeleteConfirmation(){this.showDeleteConfirmation=!1},async deleteColumn(){try{const o=await fetch("http://localhost/X-men/back/delete_column.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.column.column_id})}),e=await o.json();e.success&&this.$emit("deleteColumn",this.index)}catch(o){console.error("Ошибка при удалении колонки:",o)}finally{this.hideDeleteConfirmation()}},getContrastingTextColor(o){const e="#"===o.charAt(0)?o.substring(1,7):o,t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),a=[t/255,r/255,s/255],l=a.map((o=>o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))),n=.2126*l[0]+.7152*l[1]+.0722*l[2];return n>.179?"#000000":"#FFFFFF"}}};const Qo=(0,d.A)(Jo,[["render",Fo],["__scopeId","data-v-1b079e11"]]);var Vo=Qo,Ho=t(8355),qo={name:"BoardPage",components:{TaskColumn:Vo,draggable:No()},data(){return{columns:[],isEditMode:!1,loggedInUser:null}},async created(){await this.fetchUserData(),await this.fetchColumns()},methods:{async moveCard({card:o,fromColumn:e,toColumn:t}){const r=this.columns.findIndex((o=>o.column_id===e)),s=this.columns.findIndex((o=>o.column_id===t));if(-1!==r&&-1!==s){const e=this.columns[r].cards.findIndex((e=>e.card_id===o.card_id));if(-1!==e){const[o]=this.columns[r].cards.splice(e,1);o.column_id=t,this.columns[s].cards.push(o),await this.updateCardsOrder(t,this.columns[s].cards)}}},async updateColumn(o,e){this.columns=this.columns.map(((t,r)=>r===o?{...t,...e}:t));const t=JSON.stringify(e.color);try{const o=await Ho.A.post("http://localhost/X-men/back/update_column.php",{id:e.column_id,column_name:e.column_name,color:t});if(!o.data.success)throw new Error("Ошибка базы данных: "+o.data.error);console.log("Колонка успешно обновлена.")}catch(r){console.error("Ошибка при обновлении колонки:",r.message),alert("Не удалось обновить колонку. Попробуйте снова позже.")}},updateCardOrderInColumn(o){const e=this.columns.find((e=>e.column_id===o));e&&e.cards.forEach(((o,e)=>{o.order=e}))},async updateCardOrder(){const o=[];this.columns.forEach((e=>{e.cards.forEach(((t,r)=>{o.push({card_id:t.card_id,column_id:e.column_id,order:r})}))}));try{const e=await Ho.A.post("http://localhost/X-men/back/update_card_order.php",o);e.data.success?console.log("Порядок карточек успешно обновлен"):console.error("Ошибка при обновлении порядка карточек:",e.data.error)}catch(e){console.error("Network Error:",e)}},async createCard(){const o={id:Date.now(),title:"",content:"",color:"#666666"};try{this.localCards.push(o),this.$emit("updateCards",this.localCards)}catch(e){console.error("Error creating card:",e)}},onCreateCard(o){const e={title:this.newCardTitle,description:this.newCardDescription};this.createCard(o,e)},async createColumn(){if(!this.loggedInUser)return void console.error("Ошибка: не удалось получить идентификатор пользователя.");const o={column_name:"New Column",user_id:localStorage.getItem("userid"),color:JSON.stringify(["#d9d9d9","#d9d9d9","#d9d9d9"]),order:this.columns.length};try{const e=await fetch("http://localhost/X-men/back/create_column.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.json();t.id?(o.column_id=t.id,o.cards=[],o.color=["#d9d9d9","#d9d9d9","#d9d9d9"],this.columns.push(o)):console.error("Ошибка при создании колонки:",t.error||"Неизвестная ошибка")}catch(e){console.error("Ошибка при создании колонки:",e)}},async deleteColumn(o){const e=this.columns[o];try{const t=await fetch("http://localhost/X-men/back/delete_column.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.column_id})}),r=await t.json();r.success&&this.columns.splice(o,1)}catch(t){console.error("Ошибка при удалении колонки:",t)}},toggleEditMode(){this.isEditMode=!this.isEditMode},updateOrder(){const o=this.columns.map(((o,e)=>({column_id:o.column_id,order:e})));Ho.A.post("http://localhost/X-men/back/update_column_order.php",o).then((o=>{o.data.success?console.log("Column order successfully updated"):console.error("Error updating column order:",o.data.error)})).catch((o=>{console.error("Network Error:",o)}))},logout(){sessionStorage.removeItem("loggedInUser"),localStorage.removeItem("userid"),localStorage.removeItem("username"),this.loggedInUser=null,this.$router.push("/login")},async fetchUserData(){try{const o=await fetch("http://localhost/X-men/back/login.php",{method:"GET",credentials:"include"}),e=await o.json();e.success&&e.user_found?(this.loggedInUser=e.login,sessionStorage.setItem("loggedInUser",this.loggedInUser)):console.error("Ошибка при получении данных о пользователе:",e)}catch(o){console.error("Ошибка при получении данных о пользователе:",o)}},async fetchColumns(){try{const o=localStorage.getItem("userid"),e=await fetch(`http://localhost/X-men/back/get_columns.php?user_id=${o}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json();this.columns=t.map((o=>("string"===typeof o.color&&(o.color=JSON.parse(o.color)),o))),this.columns.sort(((o,e)=>o.order-e.order)),this.columns.forEach((o=>{o.cards.sort(((o,e)=>o.order-e.order))}))}catch(o){console.error("Ошибка при загрузке колонок:",o)}},async updateCardsOrder(o,e){try{const t=e.map(((e,t)=>({card_id:e.card_id,column_id:o,order:t})));console.log("Updating cards order:",t);const r=await Ho.A.post("http://localhost/X-men/back/update_card_order.php",t);r.data.success?console.log("Card order successfully updated"):console.error("Error updating card order:",r.data.error)}catch(t){console.error("Network Error:",t)}}},mounted(){const o=localStorage.getItem("username");o&&(this.loggedInUser=o)}};const Ko=(0,d.A)(qo,[["render",lo],["__scopeId","data-v-e31804c4"]]);var Wo=Ko;const Ro=[{path:"/",redirect:"/login"},{path:"/login",component:I},{path:"/register",component:z},{path:"/board",name:"BoardPage",component:Wo,meta:{requiresAuth:!0},props:{userId:localStorage.getItem("userid")}}],Go=(0,p.aE)({history:(0,p.LA)(),routes:Ro});Go.beforeEach(((o,e,t)=>{if(o.matched.some((o=>o.meta.requiresAuth))){const o=localStorage.getItem("userid");o?t():t("/login")}else t()}));var zo=Go;const Yo=(0,r.Ef)(h);Yo.use(zo),Yo.mount("#app")}},e={};function t(r){var s=e[r];if(void 0!==s)return s.exports;var a=e[r]={exports:{}};return o[r].call(a.exports,a,a.exports,t),a.exports}t.m=o,function(){var o=[];t.O=function(e,r,s,a){if(!r){var l=1/0;for(d=0;d<o.length;d++){r=o[d][0],s=o[d][1],a=o[d][2];for(var n=!0,c=0;c<r.length;c++)(!1&a||l>=a)&&Object.keys(t.O).every((function(o){return t.O[o](r[c])}))?r.splice(c--,1):(n=!1,a<l&&(l=a));if(n){o.splice(d--,1);var i=s();void 0!==i&&(e=i)}}return e}a=a||0;for(var d=o.length;d>0&&o[d-1][2]>a;d--)o[d]=o[d-1];o[d]=[r,s,a]}}(),function(){t.n=function(o){var e=o&&o.__esModule?function(){return o["default"]}:function(){return o};return t.d(e,{a:e}),e}}(),function(){t.d=function(o,e){for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(o){if("object"===typeof window)return window}}()}(),function(){t.o=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)}}(),function(){t.r=function(o){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){var o={524:0};t.O.j=function(e){return 0===o[e]};var e=function(e,r){var s,a,l=r[0],n=r[1],c=r[2],i=0;if(l.some((function(e){return 0!==o[e]}))){for(s in n)t.o(n,s)&&(t.m[s]=n[s]);if(c)var d=c(t)}for(e&&e(r);i<l.length;i++)a=l[i],t.o(o,a)&&o[a]&&o[a][0](),o[a]=0;return t.O(d)},r=self["webpackChunkboard"]=self["webpackChunkboard"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=t.O(void 0,[504],(function(){return t(9551)}));r=t.O(r)})();
//# sourceMappingURL=app.eecadd2f.js.map